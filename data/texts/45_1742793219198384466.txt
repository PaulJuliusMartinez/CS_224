From: ISMB-94 Proceedings. Copyright © 1994, AAAI (www.aaai.org). All rights reserved.

Leslie

RNA Modeling Using Gibbs Sampling and Stochastic Context Free Grammars*

Grate and Baskin (;enter

Mark Herbster and Richard Hughey and David Haussler for Computer Engineering and Computer and Information Sciences
University of California
Santa Cruz, CA95064

I. Saira Mian and Harry Noller Sinsheimer Laboratories University of California Santa Cruz, CA95064

Keywords: RNAsecondary structure, Gibbs sampler, Expectation Maximization, stochastic contextfree grammars, hidden Markov models, tP~NA, snRNA, 16S rRNA, linguistic methods
Abstract
A new methodof discovering the commonsecondary structure of a family of homologousRNAsequences using Gibbs sampling and stochastic context-free grammarsis proposed. (liven an unaligned set of sequences, a Gibbs sampling step simultaneously estimates the secondary structure of each sequence and a set of statistical parameters describing the common secondary structure of the set as a whole. These parametersdescribe a statistical modelof the family. After the Gibbs samplinghas produceda crude statistical modelfor the family, this modelis translated into a stochastic context-free grammarw, hichis then refined by an Expectation Maximization (EM) procedure produce a more complete model. A prototype implementationof the methodis tested on tRNA,pieces of 16S rRNAand on U5 snRNAwith good results.
Introduction
Tools for analyzing RNAare becoming increasingly important as in vitro evolution and selection techniques produce greater numbers of synthesized RNAfami-
lies to supplement those related by phylogeny. Two principal methods have been established for predicting RNAsecondary structure base pairings. The first technique, phylogenetic analysis of homologous RNA
molecules (Fox & Woese 1975; Woese el al. 1983; James, Olsen. &Pace 1989), ascertains structural features that are conserved during evolution. The second technique employs thermodynamics to compare the free energy changes predicted for formation of possible s,'covdary structure and relies on finding the structure with the lowest free energy (Tinoco Jr., Uhlenbeck, & Levine 1971: Turner, Sugimoto, & Freier 1988;
*This work was supported in part by NSFgrants C,I)A-9115268and IR1-9123692, and NIIt gratnt (.;M17129. Questions or comnlents should be addressedto haussler:.O~cse.ucsc.edu.

Gouy 1987; Zuker 1989). Whenseveral related sequences are available that all share a commonsecondary structure, combinations of different approaches have been used to obtain improved results (Water-
man 1989; Le & Zuker 1991; Han& Kim 1993; Chiu & Kolodziejczak 1991; Sankoff 1985; Winker et al. 1990; Lapedes 1992; Klinger & Brutlag 1993; Gutell et aL 1992).
Recent efforts have applied Stochastic Context-Free Grammars(SCFGs) to the problems of statistical modeling, multiple alignment, discrimination and prediction of the secondary structure of RNAfamilies (Sakakibara el al. 1994; 1993; Eddy & Durbin 1994; Searls 1993). This approach is related to use of Hid-
den Markov Models (HMMs) to model E. coli DNA (Krogh, Mian, & Haussler 1993) and protein families and domains (Krogh el al. 1994; White, Stultz, Smith 1994; Baldi el al. 1994). It incorporates elements of both the thermodynamic and phylogenetic approaches, with emphasis on the latter. The method
of Sakakibara el al (Sakakibara el al. 1994; 1993) requires someinitial knowledgeof the commonsecondary structure of the sequences in the family. In contrast, Eddy and Durbin (Eddy & Durbin 1994) derive the structure of the grammardirectly from unaligned sequences and estimate the probability parameters of the resulting grammar using Expectation Maximization (EM). Here we propose a different methodfor deriving the structure of the grammarfrom unaligned se-
quences which uses Gibbs sampling techniques (Geman & Geman1984) described in (Lawrence et al. 1993; 1994). It is related to the EMmethods described in (Neal & Hinton 1993) (incremental EM) and (Meng ,_~ Rubin 1992) (Partitioned Expectation/Conditional
Maximization, or PECM).
The Gibbs sampler we propose simultaneously estimates the secondary structure of each sequence and a statistical model of the family with parameters describing the consensus secondary structure of the set as a whole. In particular, we estimate the number of
helices, the length of each helix, the probability that a

138 ISMB-94

helix is present, and the general nesting pattern of the helices. Furthermore, for each base-pair in each helix, a separate probability distribution over the 16 possible nucleotide pairs that could occur is estimated. The Watson-Crick pairs have muchhigher a priori probabilities in this estimation, but non-Watson-Crickpairs are also allowed, with appropriately small probabilities. Since these probabilities are estimated from the
sequences, they are also influenced by phylogenetic relationships amongthe sequences The phylogenetic relationship guides the developmentof the statistical model in a large part through these probability parameters. In addition to parameters involving helices,
parameters relating to the lengths of loops and other features are also estimated. Whenthe Gibbs sampling has produced a crude statistical modelfor the family,
this model is translated into a SCFGwhich is then refined by an EMprocedure to produce a more complete model, as described elsewhere (Sakakibara el al. 1993). A prototype implementation of the method is tested on tRNA, pieces of 16S rRNA, and U5 snRNA.
Methods
Since this work builds on modeling RNAfamilies with
SCFGs(Searls 1993; Eddy & Durbin 1994; Sakakibara et ai. 1993), we provide a review of this methodfirst.
SCFG Overview A grammaris a set of productions or rewrite rules. An example of an RNAgrammar is shown in Figure 1 (in practice, a grammar would have many more productions). The symbols Si are called nonterminal symbols and So is the star1 symbol. The letters A,C,G,U are called terminal symbols and each represents a nucleotide. A grammar can be used to derive a set of RNAmolecules. A molecule is derived by starting with the start symbol, and then repeatedly choosing a nonterminal symbol in the current molecule, finding
a production in the grammarthat has that symbol on the left hand side, and replacing that symbol in the molecule with the symbols on the right hand side of the production (this is termed applying the produc-
tion), until there are no more nonterminals left in the molecule. A typical derivation is illustrated in Figure 2. Whena production is applied, the left hand side nonterminal is shownwith lines emanating from it to each of the symbolsin the right hand side. The result is called a derivation tree, which can be seen by ignoring the dashed line. Ignoring the nonterminals (imagining
that they really were replaced), leaves only the derived RNAmolecule. The primary structure of the molecule is seen by tracing the letters from left to right along
the frontier of the tree (dashed line). The secondary structure can be seen by highlighting the branching links between nucleotides that are derived from productions of the form Si "-* XSjY, where Si and Sj are nonterminals and X and Y are nucleotides. These pro-
ductions define the base-pairing in the molecule. Contiguous sequences of these base-pairs are helices (each

p={

Figure 1: This set of productions P generates RNAsequences with a certain restricted structure.
S0, S1,...,Sla are nonterminals; ,t, u, G and C are terminals representing the four nucleotides.

"'~ s o ¢/"

H has 3 membersH, 1, H2,andHS.

I,.,,t i ~_j,s\~~.. " H1

Thepositionandlengthvariablesfor this particularsequenacere:

~/~2",4,

., .,

.,2c4/~.=/.s~/ -"

/s ~s
\._.

",",~----.u
/\

113 ",^

As¯,1. Bs.1,8,1H11=2.
Am=a, SH-8=, IH21=2.

,t, s" a ,
°, x,¯ /~7~-sa~

.. /sl( --. A -lo,

'../ '~

~ S!

<"'. S12~Sls ]

B .15,1H31-3. Sl

Figure 2: Derivation tree for the RNAsequence CkUCAGGGAAGAUCUuCsiInKgIGthe grammar whose pro-
ductions are given in Figure 1. The dashed line shows the primary sequence and 7~ is the set of helix models.
The 3 helix regions are HI, H2and H3, and the nesting structure is "(00)" with H1enclosing the others.

such helix we will later denote by H). The nesting structure of the helices is apparent in the derivation: reading the sequence left-to-right, the bottom two helices are clearly nested within the topmost helix, giving the nesting "(00)'.t
For each nonterminal, placing a probability distribution over the productions with that nonterminal on the left handside, enables the selection of an appropriate production at randomevery time a rule is applied (nonterminal is replaced). The result is St ochas-
tic Context Free Grammar (SCFG). An SCFG defines a probability distribution over a family of RNA molecules, where here, for simplicity, we identify an RNA"molecule" with its primary sequence and secondary structure. The probability of a molecule is the probability that it will be derived in a random derivation, assuming each production is chosen independently. Hence an SCFGdefines a stochastic model for the family. In (Sakakibara el al. 1993), SCFGmodels were used to determine the most likely secondary
I Context-free grammarscan only represent secondary structure with properly nested helices; they cannot represent pseudoknots. Whenwe model a family with pseudoknots, these are currently ignored.

Grate 139

structure for an RNAsequence from a family, and to discriminate sequences in the family from those not in
the family. An Expectation Maximization (EM) algorithm was then used to estimate the probabilities of the productions of an SCFGfrom unaligned training sequences. Weuse these same methods here.
Gibbs Sampling for common RNA secondary structure
The Gibbs sampler we use applies a variant of the method of Lawrence and colleagues (Lawrence et al.
1994) to locate helices in RNAmolecules. Let S be set of IS I sequences (each individual sequence S E has its ownlength, ISI) with similar secondary structure. Let .hf be four parameters representing the prob-
abilities of each of the four nucleotides in the RNA family from which the sequences in S are drawn. We refer to these parameters as the null model. Let 7/ be a set of ]7-/] helix models and HE 7"/ denote an individual helix model. Helices H in 7-/ are intended to be specific parametric models of the helices that are commonto the sequences in S. Associated with each helix H are the parameters IHI, its length in base-pairs, r n, a matrix of parameters specifying the probability of occurrence for each of the 16 possible pairs of nucleotides that could occur in each base-pair of H, and pHthe probability that H is present in a sequence in the family. Associated with 7/ is a tree structure rep-
resenting the nesting relationships amongthe helices in 7"/. Collectively, these parameters of 7/form a crude statistical modelof the sequence family (defined more formally below). The goal is to estimate the structure and parameters of this model from the family of sequences S. 7/ is then used to create a grammar for this family and a more sophisticated parametric model in the form of a SCFG.
Consider the sequence in Figure 2. If this sequence
has the typical secondary structure for sequences in its family, then the 7-/for this family wouldhave 3 individ-
ual helix models, HI, H2 and H3 with the lengths as shownand would specify howthey are nested: H2 and H3are totally enclosed by HI. The locations of these helices in this particular sequence are also shown.
In order to define fully the statistical modelrepresented by 7-/, and to estimate 7"/ from the data S, it
is necessary to consider the "missing data" consisting of the set of hidden randomvariables that define the location of each helix within each sequence S. Let Si denote the i-th nucleotide of a sequence S and Si .4 the subsequence with endpoints Si and Sj. The location of a helix H within a sequence S requires knowledge about both sides of the helix. These helix location parameters are denoted AsH and Bff. The first (5') side a helix maps to the substring SA~...A~+IHI-1 and the
other (3') side mapsto the substring S1.B~...B~+IHI_ Refer to Figure 2 for an example. The variables AsH and BH are 0 if the helix H does not occur in sequence S. Xs Hdenotes the set of location variables Anand Bs

for all helices in the sequence S, and we let X denote the set of all Xs.
Wecan formally define the manner in which 7"/is a
(crude) statistical model of a family of RNAsequences using the hidden variables X. For a given sequence S,
P(SI~/) = P(S]Xs, 9t )P(Xs I~
xs
where P(S]Xs, 7t) is the probability of observing the sequence 5' given the particular placement Xs of the helices in S. Assuming independence, this is simply the product of the probabilities of each of the basepaired pairs of nucleotides in S, calculated using the parameters rH, times the product of the probabilities
of all the remaining nucleotides in S not placed in the helices, calculated using the parameters Af of the null model. The term P(Xs[?'l) is the prior probability of
the placement Xs, which is 0 for any placement that violates the nesting structure of "H, and otherwise is
proportional to the product of terms that are pn for each helix H that is placed in S and 1 - pHfor each helix not placed.
The aim of our approach is to estimate the parame-
ters in 7i from S. The method we use is MaximumA Posleriori (MAP)estimation, implemented by a Gibbs sampler/incremental EMmethod: We seek 7/ that maximizes P('H]8). By Bayes rule, this is equivalent to maximizing P(7-/)P(8]7/) = P(7~) l-Is~8 P(S[7-/).
The terms P(S]7"/) in the latter product are defined above. The prior P(7/) we define to be uniform (or "uninformed") in all parameters, except for the parameters r Hthat define the frequencies of the 16 possible
nucleotide pairs in a given base paired position. For each of these weuse a specific Dirichlet prior that we estimated from analysis of 16S rRNAmultiple alignments (Sakakibara el al. 1993). During estimation, these guide the Gibbs sampler to position helices in appropriate places in the sequences, and greatly improve the results.
Currently we use a simple greedy method, described in the next section, to initially estimate the numberof helices, their lengths and their nesting structure. Several candidate structures maybe produced. For each
of these, the Gibbs sampler is then used to computean estimate of 7/, and the best of these solutions is kept.
The sampling method we use maintains a placement
Xs of the helices from 7-/ in each sequence S E ,.q, along with current estimates of all the parameters in 7~. At each step, a single helix Hin a single sequence S is chosen at random, removed from S, and replaced at random back into S. The replacement is done according to the conditional distribution over all possible locations for the replacement given the current values of the parameters in 7"/and the current positions of the other helices in S. The parameters in 7l are then reestimated given the current placementof all helices in all sequences. 2 Apart from it's close similarity with the
2In the current implementation,the parametersin 7i are

140 ISMB-94

Gibbs sampler of (Lawrence et al. 1994) which it was modeled on, this system can also be viewed as a hy-
brid of the incremental EMmethod discussed in (Neal &: Hinton 1993} and the PECMmethod of (Meng
Rubin 1992).
in the course of Gibbs sampling, we also obtain estimates for the hidden variables ,l" giving the locations of the helices in each sequence. The Gibbs sampler can
be annealed as in (Geman& Geman1984) to make ,l' approach MAPestimates. Hence the Gibbs sampler can be used alone to try to determine the secondary structure of each of the sequences. This is a direct extension to RNAof the Gibbs sampling approach for proteins described in (Lawrence et al. 1994). However, the model 7/ used by the Gibbs sampler does not allow the length of a helix to vary between sequences, nor does it currently have any sophisticated parametric models for the loop regions. In contrast, SCFGmodels include all the parameters of the Gibbs sampling models plus site specific insertion and deletion probabilities for base-pairs within helices. More importantly, SCFGmodels have detailed parameteric models of each loop, including conserved nucleotides, average length and site specific insertion and deletion probabilities. Thus we expect to obtain more accurate secondary structure predictions from these SCFG models, at least when proper Bayesian methods are
used to avoid overfitting the sequence data.
Wehave developed a program that translates the parametric model 7/ produced by the Gibbs sampler
to a stochastic context free grammarG. The initial values of the parameters in G that cannot be obtained
from 7-/ are set according to an appropriate prior distribution. Then, using the same sequences S, the EM
algorithm described in (Sakakibara et ai. 1993) (called Tree-grammar EM) is used to obtain a MAPestimate
of the parameters of Gusing the same prior. Implicit in this estimation is a reestimation of the hidden randomvariables A" that give the locations of the helices in each sequence. Generally, we obtained improved estimates in this way. However, since the length of a helix varies from sequence to sequence in the placement assigned by the SCFGmodel, the final locations of the helices cannot be specified by the simple random variables AsH and BH defined above.
reestimated according to the mean(not the mode)of their posterior distribution givensufficient statistics (i.e. counts) from the current placementof the helicies and the paxameters of the Dirichlet priors. Since the countschangelittle in eachreplacement,this cMculationis efficient. Countsfor the helix that is beingreplaced are subtracted fromthe totaJ counts whenit is removed,the parameters of the model are reestimated before the conditional distribution on possible replacementlocations is calculated, and then the new counts from the replacementaddedback to the total counts after the replacement,as in (Lawrenceet al. 1994).

Implementation of the method
The current implementation of our model construction algorithm has three parts: the development of an initial model 7-/, a Gibbs sampling placement of the helices in 7/ in each sequence and re-estimation of the parameters of 7/, and the generation and training of
a SCFGwith Tree-Grammar EM(Sakakibara et ai. 1993). Weuse a massively parallel computer to speed the process (a MasPar MP-2204).
Development of an initial model While it is possible in principle for a Gibbs sampler with an appropriate prior and some kind of "model surgery" method similar to that used in (Kroghel al. 1994)to arrive at correct helix model 7/starting from an empty model, this method would be time consuming and prone to falling into local minima. For this reason, we set out from the start to develop an alternative method for finding a goodinitial model7/.
Our method works by first finding likely helices in
each sequence individually (making use of the prior base pairing statistics drawn from 16S rRNA(Sakakibara el al. 1993)) and then selecting a dominantnesting structure amongthose generated for each sequence in S. The initial per-sequence search is a fast top-down
parsing heuristic. In the first step, for all possible helices of length 4-14 and locations of the helix sides, we compute the numbers of bits saved (in the minimallength encoding sense) by encoding the bases of the helix jointly as base-pairs rather than as independent bases. Our encoding is based on the null model proba-
bilities of bases (denoted Af) and the prior base-pairing probabilities (r n) mentioned above. That is, for a Hgiven H E 7/, and all possible starting positions As and BH, we compute the number of bits required to encode the helix positions assuming the helix information
Inl
- log2P(SAns+i_I *-~ SBs-+lnl_ilrn), (1)
i=l
where ~ denotes base-pairing, and, as the null model,
the numberof bits required to encode the two sequence segments independently of each other
Igl
-- log2 P(Sans+i_l[Af) lo g2 P(SBff+,_11Af), (2
i=1
and we take the difference of these two numbers. Figure 3 shows examples of this cost function. The helix
position that saves the highest numberof bits is the winner, and ties are broken arbitrarily.
Because of our requirement for proper helix nesting, each location of a helix breaks the sequence into two regions where additional helices could be: the outside
(the concatenation of S1...An_I with SBns+IHI...ISl) and
the inside (Sasn+lnl...Bs, 1) of the current helix (Fig-
ure 4). These two regions are then considered independently and recursively, and a possible nesting structure

Grate 141

o, .I .. o

II

UGACCGCCCAGGG UGACCGCCCAGGG

Figure 3: Cost flmction, as defined by equation 2, of pairing a specific motif to a sequence. The ordinate is the numberof bits saved (or goodness of fit) in arbitrary units, if the motif started at that point in the sequence. A peak indicates a starting location where the inotif has a likelihood of pairing. The lefthand side shows pairing the motif GU, and the righthaud side C(JC, to the sequence shownoil the abscissa. GUwill like best to pair with CA, second best with CG,third best with U(, (as indicated by our Dirchlet priors and as seen in graph). CC(~would like best to pair with
(;G(;, and there is only one position in the sequence wherethere are three ('is in a row.

is constructed. The recursion ternfinates wheneither a region is too small (fewer than 4 bases), or whenplacing a new helix results in no encoding-length savings over not placing that helix.

Figure 4: Whentwo parts of a sequence are determined
to be base paired (shaded boxes), the inside region becomes independent from the outside regions L and R. Searching for base pairs then focuses on region 1, and the concatenation of L and R.

Structure
(()()())
((())) (((())))
(()(()))
(()())()
((()())) (()((()))) (()(())())

Number 43
9 6
4
1
1 1
1

Structure (()())
((())()) (0()()())
()()()
((()0)0)
((()))()
((0)()()) ()(()())

Number 16
8 4
2
1
1
1
l

Figure 5: Nesting structures produced by the greedy algorithm for 100 tRNAsequences. The correct cloverleaf tRNAnesting structure, "(0()())", clearly dominates,
the second most commonis this structure with one helix removed.

After completing this process on all sequences, the resulting nesting structures are compared, and the number of occurrences of each nesting type is tabu-
lated (Figure 5). From these, a single dominant, most frequently occuring, nesting structure is chosen for use in the Gibbs sampleing phase.

Refillelnent with Gibbs Sampling When trying to estimate the secondary structure of the sequences directly from the Gibbs sampler without using a SCFG, the goal is to estimate the locations ,l' of all helices
in the model in all sequences in 8. During this phase the nesting structure of the helix model7~ is fixed.
Weexplored letting the helix lengths IHI be variable (i.e. re-estimated during sampling) and holding them fixed. Weexaminedre-estimating the helix probability parameters pHand the base-pair probability matrices rH and holding them fixed to the modeof the prior.
There is a "freezing" option in which as soon as the placement Xs of the helices of the model7/ on a sequence,5' fits the nesting structure, S is removedfrom future consideration by the Gibbs sampler and Xs is "frozen". In this case we rely on the SCFGproduced in a later stage to reliably reestimate the secondary
structure of S in cases whereits structure is frozen in to a suboptimal configuration.
(liven a current placement Xs for the helices on a
sequence S', the inner loop of the Gibbs sampling phase for ,5" consists of selecting uniformlyat randomHE 7-/ and modifying its position. For each possible repositioning X~; of Hin the sequence o°, including the case swhen H does not occur in S, we calculate

)P( SIX~s,7~)P(X~s[7-I P(XlXs, U)P(Xs In)

(a)

These numbers are then normalized to sum to 1, to generate a posterior distribution over repositionings. This distribution will look very similar to those in Figure 3, where the abscissa indicates a pair of sequence starting positions. A newlocation for helix H in sequence%is then selected at randomfrom this distribut.ion, and it will probably be one of the highly favored positions that correspond to the peaks in the distribution.
Normally, we only consider repositionings of H that do not overlap the current positions of the other helices in 5' and are consistent with the nesting structure in 7-/. tlowever, weobtain improvedresults if a repositioning of H mayoverlap another helix. In this case this other helix is simply removed, and (3) is calculated for the resulting X~. Whenthe parameters of 7/are not held fixed during the Gibbs sampling, these parameters are re-estimated after each of the above helix replacements
using the same method as in (Lawrence el al. 1994), nemploying the Dirichlet priors in the case of the r parameters.
For each S E 8, a phase of the Gibbs sampling consists of performing the inner loop helix replacement a sufficient numberof times to allow all helices several chances at repositioning within S (experimentally, 717-/I). If the "freezing" option is turned on, se-

aActually, there is a slight adjustmentto the parameters in 7"( whenthe counts for the position of the helix Hin are decrementeddue to its removal, as in (Lawrenceet al. 1994).

142 ISMB-94

quences that match the dominant structure to start with require zero Gibbs phase iterations. The number of phases required to reach the point where few, if any, additional sequences are fit is very data dependent (around 4 phases for tRNA,and 15 or more for U5 snRNA).This is due to the presence of variant structures in the sequences. If some sequences lack some helices or the helices are of widely varying lengths, it is difficult for the sampler to identify wherethese helices fit in the overall model.
Training and evaluating the SCFGThe initial SCFGfor this part of the method is formed from the Gibbs sampling model 7-/ by considering only the sequences in S that match the dominant helix nesting structure. First, the helix productions of the grammar are generated based on the nesting structure and helix lengths found in 7-/. In our current implementation, the initial probabilities for each helix position are taken only from the prior distribution; in the future, wewill transfer position-dependent base pairing statistics from the Gibbs sampler to the SCFG.The length of the loop regions between the helices are estimated as the arithmetic meanof the loop regions across the sequences.
The grammaris then trained using the entire sequence set S (including the ones the Gibbs sampler was unable to match to the dominant nesting structure). The parser associated with the SCFGtraining algorithm is used to determine the final estimate of the secondary structure of each sequence based on the trained grammar, see (Sakakibara el ai. 1993).
Software. implementation The MasPar MP-2204 at UCSCis a single instruction stream, multiple data stream (SIMD)parallel computer with 4096 32-bit processing elements arranged in a 64 x 64 grid (Nickolls 1990). It provides fast evaluation of all possible helix locations during our greedy model creation step. One processing element can be assigned to each of the O(n2) possible positions of helices of length l, and all positions are evaluated in parallel in O(l) time. The minimum-costposition, following the greedy paradigm, is then located in O(logn) time and reported to the controlling program. Gibbs sampling iterations benefit in the same way.
Experimental Results
For tRNA, U5snRNA,and parts of E. coil 16S rFtNA, we produced helix nesting models (i.e. 7t) using the Gibbs sampler. In the case of tRNA,this was translated to a SCFGfollowed by refinement using TreeGrammarEM. All experiments used the freezing option and fixed helix lengths in the Gibbs phase (lengths having been determined in the greedy phase).
tRNAIn our previous studies of tRNA (Sakakibara et al. 1993), we employed a hand generated helix nesting structure that captured fine details of tRNA

structure. Wewould not expect the SCFGgenerated from the results of the Gibbs sampler to achieve the same level of detail for this or any other RNAfamily. However,if the nesting structure and estimates of the helix and loop lengths are fairly reasonable, we hoped that the Tree-GrammarEMalgorithm would learn sufficient details to producea sensitive discriminator.
Sequences were taken from a database that includes
tRNAsfrom virus, archaea, bacteria, cyanelle, chloroplast, cytoplasm and mitochondria (Steinberg, Misch, & Sprinzl 1993). We used l0 sequences chosen at
random from 1222 tRNAsto produce a helix nesting model which was then translated into a SCFG. The results were essentially insensitive to the numberand choice of the sequencesie. similar results were obtained whenthe data set consisted of 4 to 100 sequences. This
Gibbs grammar was compared to the hand generated nesting structure from our earlier work (Sakakibara et al. 1993). Both nesting structures were similar cloverleaf structures and corresponding helices had similar lengths (Figure 6). Starting from the Gibbs generated grammar, we repeated our earlier experiments that used the training set MT10CY1a0nd Tree-GrammarEM
(Sakakibara el al. 1993) to produce a discriminator. This discriminator (which was totally automatically produced, the only humaninput was choosing the initial sequences) wasnot as sensitive as our previous one, but is still remarkably good(Figure 7).
16S rl%NA We examined three regions of 16S rRNA corresponding to nucleotides 588 to 880 in E. coil 16S
rRNA (Woese et al. 1980; Noller & Woese 1981; Woeseel al. 1983; Gutell et al. 1985). For each of the three segments, we used the Gibbs sampler to produce helix nesting models for four sequences (E. coil and three archaea) taken from the RDP(Larsen el al. 1993). Figure 9 showsthe three regions along with the consensus structure produced from their respective Gibbs sampler models. Although Gibbs sampling produced a very good nesting structure, each individual sequence can differ from the standard.
U5 snRNAsnRNAs are expected to be more difficult than tRNAand 16S rRNAbecause the structures change dynamically in vivo and strong static secondary structures maynot be so prominent (Guthrie ~z Patterson 1988; McKeown1993; Wise 1993). Weused 34 U5 snRNAsequences (Guthrie, Roha, & Mian 1993) produce helix nesting models (Figure 8). Gibbs sampiing finds the accepted secondary structure (Guthrie ~: Patterson 1988) with the addition of one extra stem (stem X).
Discussion
We have described a new method to help determine the commonsecondary structure of homologous RNAmolecules from a set of unaligned sequences using Gibbs sampling techniques similar to those that have been applied to proteins (Lawrence et al. 1993;

Grate 143

1994). The method is used to estinaate tile numbers, lengths and nesting structure of RNAhelices in related RNAsequences. Previously, we relied on hand generated grammars to derive the structure of the grammar from unaligned primary sequences (Sakakibara el al. 1993). The novel aspect of the Gibbs sampling approach is that this task is performed automatically. The resulting crude statistical model is then translated into a SCFGand subsequently refined using EM. Since the model probabilities are computed from the sequences themselves, the phylogenetic relationships guide development of the model. While we have not exI)lored the methodcompletely yet, it has been applied with some success to tRNA, U5 snRNAand regions of
16S rRNA.Wehad less success in applying it to other snRNAfamilies and to whole 16S sequences.
()he of the weaknesses of the present method is the greedy step to determine the nesting structure of the helices in the model. For families of longer P~NAsequences, with more complex nesting structure, and for families with more variant structure, this method will often not produce a clear dominant nesting structure. We performed experiments in which Gibbs sampling is used to sinmltaneously estimate the locations and parameters of manyhelices without requiring a rigid
eotnlnoll nesting structure. However,the results were not very promising. It appears that without somekind of information about the preferred locations of the helices within the sequence, there is too much"noise" in the form of competing placements for the Gibbs sampler to reliably sort things out. Thus, the method described here does not appear to scale up well to larger RNArnodeling problems.
In order to address these problems, we are currently modifying the method to use information from a nml-
tiple alignment of the sequences to suggest the locations of potential helices in the modeland their nesting
structure, and to constrain the search for revised helix locations during (libbs sampling. Weuse an IIMMto align the sequences initially as in (Krogh et al. 1994), and then later add special penalty functions to this HMMto encourage base pairing in the helices we have found.
Acknowledgements
The authors thank Kevin Karplus, (',hip Lawrence, Gary Stormo, and Michael Watermanfor helpful dis-
cussion of these ideas, and Michael Brown,Deirdre Des Jardins, KimmenSjSlander, and Rebecca U'nderwood
for providing someof the software.
References
Baldi, P.; (',hauvin, Y.; Hunkapillar, T.; and McClure, M. 1994. ttidden markovmodels of biological primary sequence information. PNAS91:1059-1063.
C, hiu, D. K., and Kolodziejczak, T. 1991. Inferring consensus structure from nucleic acid sequences.
CABIOS 7:347-352.

Q15-'C;--C:C3'CA

GQC-,--UCG-70 A-U

U--A

AAOACU|C0 ~ U U--A IIII

' GACGCCUA
%III,Iu.u%Gu¢

20

G C_GAGG ¢A---UG

30¢-G,---uC,-40

5" (1) ~ 0o)
(31)

Figure 6: A standard tRNA(left) and tRNAstructure produced by the Gibbs generated grammar (right). Only the fine hand tuned details are different: there is a bi-modal length distribution on someof the loops whereas the automatically generated Gibbs grammar structure has a single average loop length. The numbers in parenthesis indicate what position in the predicted structure mapsto the real secondary structure. Note that the length of the loop regions is variable, but the lengths of base paired regions are constant. Since the loop lengths in the grammarstructure are averaged from the sequences used to create the grammar, there is not a one to one correspondence between the nucleotide positions of the two structures.
Eddy, S. R., and Durbin, R. 1994. RNAsequence analysis using covariance models. NAR in press.
Fox, G. E., and Woese, C. R. 1975.5S RNAsecondary structure. Nature 256:505-507.
(leman, S., and (leman, D. 1984. Stochastic relaxations, Gibbs distributions and the Bayesian restoration of images. IEEETrans. on Pattern Analysis and MachineIntelligence 6:721-742.
Gouy, M. 1987. Secondary structure prediction of RNA.In Bishop, M. J., and Rawlings, C. R., eds., Nucleic acid and protein sequenceanalysis, a practical approach. Oxford, England: IRL Press. 259-284.
Gutell, R. R.; Weiser, B.; Woese,C. R.; and Noller,

Figure 7: Discrimination histograms for tRNA, using the hand generated grammar(left) (Sakakibara et al. 1993), and the Gibbs grammar(right). This technique provides a very sensitive method of determining if a sequence is a memberof a particular family.

144 ISMB-94

Figure 8: The accepted secondary structure for human U5snRNA(left), and fit to the helix nesting structure produced by the Gibbs sampler (right). The stem/loop l and 2 regions are similar to the generally accepted ones (Guthrie & Patterson 1988). Stem X is in a variable region and frequently forms using part of the Urich Smbinding site and A residues between stem la and the Smbinding site (it is not found in 20%, 7 out of 34, sequences).
H. F. 1985. Comparative anatomyof 16S like ril)osoreal RNA.volume 32 of Prog. Nuc. Acids. Res. Mol. Biol. 155-216.
Gutell, R. R.; Power, A.; Hertz, G. Z.; Putz, E. J.; and Stormo, G. D. 1992. Identifying constraints on the higher-order structure of RNA:continued development and application of comparative sequence analysis methods. NAR20:5785-5795.
Guthrie, C,., and Patterson, B. 1988. Spliceosomal snRNAs. ARGen 22:387-419.
Guthrie, C.; Roha, H.; and Mian, !. S. 1993. Spliceosornal snR, NAstructure: function. LInpublished.
Han, K., and Kim, H.-J. 199.3. Prediction of common folding structures of homologous RNAs. NARes 21:1251-1257.
James, B. D.; Olsen, G. J.; and Pace, N. R,. 1989. Phyiogenetic comparative analysis of RNAsecondary structure. Methods in Enzymology 180:227-239.
Klinger, T., and Brutlag, D. 1993. Detection of correlations in tRNAsequences with structural implications. In Hunter, L.; Searls, D.; and Shavlik, J., eds., First International Conference on Intelligent Systems for Molecular Biology. Menlo Park: AAAIPress.
Krogh, A.; Brown, M.; Mian, I. S.; Sjglander, K.; and Haussler, D. 1994. Hidden Markov models in computational biology: Applications to protein modeling. Journal of Molecular Biology 235:1501-1531.
Krogh, A.; Mian, I. S.; and Haussler, D. 1993. A Hidden Markov Model that finds genes in E. colt DNA. Technical Report UCSC-CRL-93-33, University of C, alifornia at Santa Cruz, Computerand In-

. oou
" -'°'"

x@

(aeQ)(S741 /T~
(170)
Figure 9: Three different regions of E. colt 16S rRNA showing the secondary structure (left) and consensus structure produced by the Gibbs Sampler (right). (There is not a one to one correspondence between the
nucleotide positions of the two structures because the loop lengths in the grammarstructure are averaged from the sequences used to create the grammar: thus do not match any particular sequence) A. Nucleotides 588 to 651; The numberof helices is correct, but the rightmost one is too short. B. Nucleotides 652 to 752. The base paired region around 680 corresponds very well. In the region between 660 and 670, the loop in the standard secondary structure is incorporated into
the long helix. The base paired region around 690 is shifted so that it formsa 4 long base paired region containing 2 CGbonds. Likewise, the region around 720 is shifted so that it forms a 4 long helL,: containing 3 CG bonds. C. 767 to 880. The base paired regions around 770,785, and 820 are in excellent agreement. The two base paired regions 840 and 862 are both shifted. In
the 840 region the standard structure has manyweak GUbase pairs. The Gibbs sampler finds a slightly more strong pairing incorporating the loop and bases around region 855.

Grate 145

formation Sciences Dept., Santa Cruz, CA95064. in preparation.
Lapedes, A. 1992. Private communication.
Larsen, N.; Olsen, G. J.; Maidak, B. L.; McCaughey, M. J.; Overbeek, R.; Macke, T. J.; Marsh, T. L.; and Woese, C. R. 199:}. Tile ribosomal database project. NARes 21:3021-3023.
Lawrence, (). E.; Altschul, S.; Boguski, M.; Liu, J.; Neuwald, A.; and Wootton, J. 1993. Detecting subtie sequence signals: A Gibbs sampling strategy for multiple alignment. Science 262:208-214.
Lawrence, C. E.; Altschul, S.; Wootton, J.; Boguski, M.; Neuwald, A.; and Liu, J. 1994. A gibbs sampler for the detection of subtle motifs in multiple sequences. In Proceedings of the Hawaii International Conference on System Sciences, 245-254. Los Alamilos, (',A: IEEEComputerSociety Press.
Le, S. Y., and Zuker, M. 1991. Predicting common foldings of homologousRNAs.J. Biomolecular Structure and Dynamics 8:1027-1044.
McKeown,M. 1993. The role of small nuclear RNAs in RNAsplicing. Current Opinion in Cell Biology 5:448-454.
Meng, X.-L., and Rubin, D. B. 1992. Recent extensions to the emalgorithm. Bayesian Statistics 4:307-320.
Neal, R. M., and Hinton, G. E. 1993. A new view of the emalgorithm that justifies incremental and other variants, to appear in Biometrika.
Nickolls, J. R. 1990. The design of the Maspar MP-I: A cost effective massively parallel computer. In Proe. COMPCONNpring 1990, 25---28. IEEE Computer Society.
Noller, H. F., and Woese, C. R. 1981. Secondary structure of 16S ribosomal RNA.Science 212:403411.
Sakakibara, Y.; Brown, M.; Hughey, R.; Mian, I. S.; SjSlander, K.; Underwood.R.; and Haussler, D. 1993. The application of stochastic context-free grammars to folding, aligning and modeling homologous RNA sequences. Technical Report UCSC-CRL-94-14,University of (',alifornia, Santa (~ruz, (:ornputer and formation Sciences Dept.. Santa Cruz, CA95064.
Sakakibara, Y.; Brown, M.; Mian, I. S.; Underwood, R.; and Ilaussler, D. 1994. Stochastic context-free grammars for modeling RNA.In Proceedings of the Hawaii International Conference on System Sciences. Los Alamitos, CA: IEEE Computer Society Press.
Sankoff, D. 1985. Simultaneous solution of the RNAfolding, alignment and protosequence problems. SIAMJ. AppL ,~lath. 45:810-825.
Searls, D. B. 1993. The computational linguistics of biological sequences. In Artificial Intelligence and Molecular Biology. AAAIPress. chapter 2, 47-120.

Steinberg, S.; Misch, A.; and Sprinzl, M. 1993. Compilation of tRNAsequences and sequences of tRNA genes. NAR 21:3011-3015.
Tinoco Jr., I.; Uhlenbeck, O. C.; and Levine, M. D. 1971. Estimation of secondary structure in ribonucleic acids. Nature 230:363-367.
qhJrner, D. H.; Sugimoto, N.; and Freier, S. M. 1988. RNAstructure prediction. Annual Review of Biophysics and Biophysical Chemistry 17:167-192.
Waterman, M. S. 1989. Consensus methods for folding single-stranded nucleic acids. In Waterman,M. S., ed., Mathematical Methods for DNASequences. CRC Press. chapter 8.
White, J. V.; Stultz, C. M.; and Smith, T. F. 1994. Protein classification by stochastic modelingand optimal filtering of amino-acid sequences. Mathematical Biosciences 119:35-75.
Winker, S.; Overbeek, R.; Woese, C.; Olsen, G.; and Pfluger, N. 1990. Structure detection through automated covariance search. CABIOS 6:365-371.
Wise, J. A. 1993. Guides to the heart of the spliceosome. Science 262:1978-1979.
Woese, C. R.; Magrum, L. J.; Gupta, R.; Siegel, R. B.; Stahl, D. A.; Kop, J.; Crawford, N.; Brosius, J.; Gutell, R.; Hogan, J. J.; and Noller, H. F. 1980. Secondarystructure modelfor bacterial 16S ribosomal RNA:phylogenetic, enzymatic and chemical evidence. NARes8:2275-2293.
Woese, C. R.; Gutell, R. R.; Gupta, R.; and Noller, F[. F. 1983. Detailed analysis of the higher-order structure of 16S-like ribosomal ribonucleic acids. Microbiology Reviews 47(4):621-669.
Zuker, M. 1989. On finding all suboptimal foldings of an RNAmolecule. Science 244:48-52.

146 ISMB-94

