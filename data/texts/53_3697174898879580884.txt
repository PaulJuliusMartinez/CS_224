Transfer Equations in Global Illumination
James Arvo Program of Computer Graphics
Cornell University
Abstract
The purpose of these notes is to describe some of the physical and mathematical properties of the equations occurring in global illumination. We rst examine the physical assumptions that make the particle model of light an appropriate paradigm for computer graphics and then derive a balance equation for photons. In doing this we establish connections with the eld of radiative transfer and its more abstract counterpart, transport theory. The resulting balance equation, known as the equation of transfer, accounts for large-scale interaction of light with participating media as well as complex re ecting surfaces. Under various simplifying assumptions the equation of transfer reduces to more conventional equations encountered in global illumination.
1 Introduction
Global illumination connotes a physically-based simulation of light appropriate for synthetic image generation. The task of such a simulation is to model the interplay of light among large-scale objects of an environment in order to approximate the quantity and quality of light reaching the eye of an observer. The problem is global in that all objects can interact with one another by means of scattered light. To properly simulate the lighting of a room, for instance, the entire surroundings must be taken into account architectural features and even the interior decoration can a ect the overall illumination 32].
But why the emphasis on physically-based simulation? The answer is that we wish to accurately predict the appearance of a hypothetical scene, and by imitating the physics we might thereby approximate the visual stimulus of viewing the scene. Of course, there is more to it than physics. In addition to the behavior of light, there are many important considerations in producing a convincing image for instance, the characteristics of the display device, the physiology of the eye, and even the psychology of perception.
Although global illumination does not reduce to physics and computation alone, these aspects currently dominate the eld. Consequently, global illumination is predominantly the study of algorithms for simulating the interaction of visible light with large-scale geometry that is, geometry with at least some features signi cantly larger than the wavelength of the light. These goals are by no means unique to global illumination.
Global illumination can be considered a sub eld of radiative transfer, which is the study of the interaction of radiant energy with matter at the macroscopic scale 7, 43]. The origin
Copyright c 1993 by James Arvo
1-1

Transfer Equations in Global Illumination

1-2

of radiative transfer theory is generally attributed to the astrophysical work of Schuster 48] and Schwarzschild 49] near the turn of the century. Since then, it has found application in areas such as illumination engineering 31], radiative heat transfer 51], hydrologic optics 44], agriculture 34, 33], remote sensing 3, 12], vision 64], and computer graphics 13]. The central tenets of radiative transfer are embodied in the equation of transfer an integrodi erential equation describing the gross interaction of light with participating media and, given appropriate boundary conditions, its interaction with arbitrary surfaces. Although rendering methods exist for simulating participating media 21, 46], the origin and extensive history of the equation of transfer are not widely recognized within the computer graphics community. Studying the equation of transfer is an excellent way to build a bridge to the vast literature in radiative transfer and its direct descendants, and this is one purpose of these notes.
Global illumination can also be viewed as a sub eld of transport theory 2, 17, 9], a eld that encompasses all macroscopic phenomena resulting from the interaction of in nitesimal particles with a medium. The macroscopic behaviors of photons, neutrons, and gas molecules are all within its purview. The central equation of transport theory is known as the Boltzmann equation.
Placing global illumination in the larger context of transport theory reveals common ground with elds such as neutron transport theory and the kinetic theory of gases. There are advantages in exploring the similarities. While neutron migration may appear to have little to do with rendering a foggy atmosphere, the equations governing the two phenomena are virtually identical. Consequently, we can gain insight from the older, more developed theories that describe such phenomena. As a more practical matter, many numerical techniques have been devised in related elds, and these are only beginning to be explored in global illumination. A wide assortment of Monte Carlo techniques have been developed for neutral particle transport 27, 55] that are relevant to global illumination 1]. The concept of importance for view-dependent radiosity 54] is another example of a technique adapted from a related eld 26].
In the remainder of this section we examine some of the the assumptions of global illumination and characterize the underlying physical model. In section 2 we derive a wellknown transport equation for abstract particles. In section 3 we specialize the abstract equation to radiative transfer and deduce from it various equations occurring in computer graphics.
1.1 The Physical Basis of Global Illumination
What does it mean for global illumination to be physically-based? Certainly it implies that the simulation of light is in some sense faithful to the actual physical behavior of light. Yet no image synthesis technique in use today captures the full repertoire of light. Ray tracing 61] and radiosity 13, 38] feature nearly mutually exclusive models of light re ection: each valid in itself, but incomplete. Methods that combine ray tracing and radiosity typically neglect more complex modes of re ection 53]. The rendering equation 19] and methods that incorporate complex surface re ection 4, 52] still neglect light scattering by participating media such as smoke. Methods that model participating media have thus far limited the forms of surface re ection 46, 47, 21]. Finally, absent from all of the cited approaches are macroscopic e ects due to interference and di raction. Every global illumination algorithm assumes some model of light and, with the possible exception of quantum

Transfer Equations in Global Illumination

1-3

electrodynamics 10], every model of light is itself incomplete. Maxwell's equations provide a very detailed description of light, accounting for a wide
variety of phenomena including dispersion, interference, and di raction. However, this physical optics level of description is overly detailed for global illumination. It is most relevant at scales on the order of the wavelength of light, where wave optics e ects predominate. Geometrical optics, on the other hand, deals with the large-scale behavior of light, ignoring the wave-related details of physical optics. However it leaves out too much. Pure geometrical optics is insu cient for global illumination because it incorporates no radiometric concepts for the measure of light 22].
For global illumination, we need to model visual phenomena those that are observable by the eye or any instrument capable of discriminating light intensity and frequency. This is called a phenomenological level of description as it focuses on phenomena corresponding to percepts such as brightness and color. Because the principles of radiative transfer operate at a size scale large compared to the wavelength of light, and a time scale large compared to the frequency, it is essentially a phenomenological description of the behavior of light 43]. Thus, radiative transfer matches the needs of global illumination.
Radiative transfer does not provide explanations of phenomena at the level of quantum mechanics or electromagnetism, yet it must incorporate information from these more detailed levels. Theories at the microscopic scale are usually needed to predict rst-order e ects such as local scattering and absorption, which then enter into the simulations at the macroscopic scale. For instance, the physically-based re ection model of He 16] employs wave optics to characterize re ection from rough surfaces, and this model can be used for global illumination 52]. For many materials with complex microgeometries, there exists a natural hierarchy of scales, with geometrical optics taking over at the point when wave effects become negligible 60]. Another avenue by which physical optics e ects can enter into radiative transfer is through physical measurements incorporating bidirectional re ectance functions of actual materials is a prime example 57].
1.2 Dimensions and Units
Every physically-based simulation ultimately concerns physical quantities that is, measurable attributes of phenomena or of matter 35]. Implicit in any equation expressing a relationship among physical quantities is a system of units in which the quantities were measured. Thus, each algebraic equation with a physical interpretation has a corresponding dimensional equation showing how the units combine 18]. Unfortunately, the units for radiometric quantities can be troublesome, owing to the overwhelming number of distinct and sometimes inconsistent de nitions 30, 56, 36, 37, 20]. As we begin to consider domains outside of radiative transfer the problem grows worse each eld has its own bewildering assortment of units and terminology. This unfortunate fact is largely historical, resulting from independent development of many fundamentally related elds.
One defense against the onslaught of unfamiliar units and terminology is dimensional analysis that is, explicit examination of the associated dimensional equations. While dimensional analysis cannot determine unknown coe cients, it can reveal necessary relationships among the quantities involved 18], and provides a rst check of validity. Throughout these notes, physical units will be discussed along with each quantity. We shall use the standard notational device of brackets to the right of an equation to indicate the units possessed by each term of the expression or equation.

Transfer Equations in Global Illumination

1-4

The present discussion is restricted to the physical domain, so we need not introduce luminous intensity or its corresponding unit, the candela. This will keep the proliferation of units to a minimum. The only units that we shall have occasion to use are the following, from the international system of units 35]:
Quantity Units Symbol time second s length meter m solid angle steradian sr energy joule J power watt W Time, length, and solid angle are base units, while energy and power are derived units. The joule has base units of m2 kg s;2, where kg is the unit of mass, and the watt is joules per second. For our purposes we needn't reduce energy to anything more fundamental. We can simply treat the joule as a base unit corresponding to some irreducible quantity that nature has provided.
2 A Balance Equation for Particles
The macroscopic phenomena modeled by radiative transfer are accounted for by the particle model of light. Consequently, radiative transfer is synonymous with photon transport, a term connoting large-scale statistical behaviors of photons. This perspective leads naturally to Monte Carlo simulations, in which large numbers of photon histories are tallied 50], but it also provides a convenient conceptual model.
In this section we approach radiative transfer by rst reducing the model of light to the bare essentials, leaving behind only abstract particles. This captures the spirit of transport theory, a theory whose goal is to determine the distribution of abstract particles in space and time, taking into account their motion and interaction with a host medium. The resulting distribution is expressed purely in terms of the geometrical and physical properties of the medium 5, 9].
Transport theory is classical in nature, yet its focus on discrete particles di erentiates it from classical theories such as electromagnetism. It requires many assumptions concerning the nature of these particles 27, 62]. The two most important assumptions are that 1) the particles are so small and numerous that their statistical distribution can be treated as a continuum, and 2) at any point in time a particle is completely characterized by its position and velocity, and internal states such as polarization, frequency, charge, or spin. These assumptions lead naturally to the notion of phase space.
Phase space is an abstraction for dealing with con gurations of particles. Each dimension of phase space represents a degree of freedom of a particle commonly six in all. For
simplicity, we shall only consider particles that move with a constant speed v and possess
no internal states. This restricted problem corresponds to gray or mono-energetic radiative transfer, or one-speed transport for generic particles. The one-speed assumption requires only ve degrees of freedom per particle three for position and two for direction. The
corresponding 5-dimensional phase space is R3 S2 where R3 is Euclidian 3-space and S2 is the unit sphere in R3.

Transfer Equations in Global Illumination

1-5

To exactly characterize a con guration of particles we must specify all degrees of freedom of each particle at an instant in time this corresponds to discrete points in phase space. Such a complete accounting for discrete particles has a natural analogue for a continuum
of particles namely, phase space density. Phase space density, denoted by n(r ! t), is a
real-valued function de ned over phase space and time such that

n(r ! t) drd!

(1)

is the number of particles in a di erential volume dr about the point r 2 R3 moving in a direction within a di erential solid angle d! about ! 2 S2 at time t. Thus, its units are
m;3sr;1. Phase space density makes no mention of material attributes such as mass or energy these concepts do not enter until we assign physical meaning to the particles, as we do in section 3. The abstract nature of phase space density makes it quite universal, it underlies virtually all particle transport problems from radiative transfer to gas dynamics.

dA 

d

ds

Figure 1: Phase space ux is the number of particles crossing the surface dA perpendicular to ! per unit area, per unit solid angle, per unit time.

It is frequently more convenient to characterize the density of particles by their rate of ow across a real or imaginary surface. Consider the particles that pass through a
di erential area dA with directions in di erential solid angle d! about the surface normal in time dt. All the particles are contained within the volume dA ds, where ds = v dt, as
shown in Figure (1). Assuming that r is a point within this volume, the number of particles
is

n(r !) dA ds d!:

(2)

But rather than focusing on the particles within a volume can shift emphasis to the surface
dA and the rate at which particles cross it by de ning phase space ux :

(r !) v n(r !)

1 m2 sr s

.

(3)

In terms of phase space ux, the number of particles in dA ds is

(r !) dA d! dt:

(4)

Transfer Equations in Global Illumination

1-6

scattering

Emission

Streaming

absorption Collisions

Figure 2: Particle behaviors fall into three categories: emission, streaming, and collisions. The latter is further divided into absorption and scattering.
Phase space ux will be the fundamental quantity of interest it can be used to express virtually any quantity relating to a distribution of particles. Our goal is to derive an equation for the function based on particle conservation this requires that we characterize all properties of the particles that can a ect their motion through the medium. We observe that all particle behaviors fall into one of three categories: emission, streaming, and collisions.
Emission is the name given to any physical process that injects new particles into the system. Physically, emission may result from chemical, thermal, or even nuclear processes. Once emitted, particles travel until they su er an instantaneous collision. For neutral particles, such as photons and neutrons, the path followed is independent of external forces, and the behavior of following such a path is called streaming. For photons this path is determined by the eiconal equation 28] which accounts for continuously varying index of refraction. If we neglect refraction, as we shall do here, streaming is in straight lines.
Collisions imply interactions with matter, and can be further subdivided into absorption and scattering. Absorption removes a particle from the system by capturing it and converting its energy into some other form, such as thermal motion of the medium. Scattering is a process that instantaneously changes the direction of travel of a particle. See Figure (2). If the speed of travel or energy of the particle remains unchanged by the scattering it is called elastic. All scattering is assumed to be elastic in one-speed transport.
A very common assumption concerning collisions is that particles do not interact with one another or more precisely, that such interactions are negligible. In the absence of this assumption, the rate of collision is itself a function of the particle distribution a situation leading to a non-linear balance equation. This source of non-linearity is sometimes unavoidable, as in some problems of gas dynamics 14]. To preserve linearity in photon transport it is necessary to ignore e ects such as interference, which imply photon-photon interactions. In neutron transport, where inter-particle collisions are exceedingly rare, this assumption is almost universally made.
2.1 An Abstract Transport Equation
In this section we derive a broadly applicable balance equation for neutral non-interacting particles the same equation appears in both radiative transfer and neutron transport theory. The approach we shall take is similar to that of Duderstadt and Martin 9], and is sometimes

Transfer Equations in Global Illumination

1-7

×=

volume V

solid angle 

phase space volume V × 

Figure 3: The Cartesian product of a volume and a solid angle results in a ve-dimensional volume in phase space.

called the Eulerian derivation 40] since the analysis is carried out with respect to a xed

reference frame.

To derive a balance equation for the particles, we begin by examining the particles

within some xed volume in phase space. Let V R3 be an arbitrary volume, let S2

be an arbitrary solid angle, and consider the cartesian product V . This product is a

set consisting of all pairs (r !) such that r 2 V and ! 2 , as depicted in Figure (3). Our

task is to determine how the number of particles in V changes with time. At any time

t, the number of particles in this volume, N(t), can be obtained by integrating phase space

density over the 5-dimensional volume:

ZZ

N(t) = n(r ! t) dr d!

(5)

V

which results in a dimensionless quantity. We now consider the time derivative of N(t).

In general, the number of particles in a given volume can change with time due to time-

dependent properties of the medium and sources, or due to transient e ects as the system

moves toward equilibrium. However, we need only consider the stationary or steady state

distributions since the speed of light is e ectively in nite compared to rates of macroscopic

motion in habitable environments. Thus, we can assume that equilibrium is reached instan-

taneously with respect to the geometric con guration of the environment at any point in

time. Each volume then has a xed number of particles, which implies that phase space

ux is independent of time, = (r !), and that

dN (t) dt

=

0

1 s

.

(6)

Yet even in the stationary case time is evident in the constant motion of the particles,

implying that the equilibrium is dynamic. The ow of particles into and out of V

must exactly balance. To examine this balance it is instructive to rst identify all possible

physical processes by which N could change, and then group the terms into gains and losses.

By equating the gains with the losses we arrive at a stationary balance equation for V .

Each of the three processes, emission, streaming, and collisions, can change the number of

particles within V , so we require that

2 change 3 2 change 3 2 change 3

4 due to 5 + 4 due to 5 + 4 due to 5 = 0:

(7)

Emission Streaming Collisions

Transfer Equations in Global Illumination

1-8

n

V
dA
V





dA
n




dA




n

Figure 4: Integrating the ux due to over the surface @V .

The rst component, the change due to emission, accounts for the creation of new particles by sources. We assume that there are one or more physical processes generating new
particles and that the combined e ect is described by a phase space source function q, a real-valued function de ned on R3 S2. The phase space source function gives the number
of particles created per unit volume, per unit solid angle, per unit time, so its units are
m;3sr;1s;1. In terms of q, the change in N due to emission is

ZZ
E q(r !) dr d! V

1 s

.

(8)

Note that the units of E are in accord with the time derivative of N. Next, we account for
particles with directions in that either escape from or enter into the volume V simply
by streaming. More precisely, the change due to streaming is the net ow of particles with
directions in that pass through the surface @V of volume V . The process of streaming
through a real or hypothetical surface is called leakage. The leakage through each di erential patch on the surface depends only on the component of the ux that is normal to the patch. Integrating the normal component of the ux due to particles in over the entire surface
@V , we have

ZZ
S (s !) ! n(s) ds d! @V

1 s

,

(9)

which is the change in N due to streaming through @V . In general, some of the di erential
surface patches will have positive ows and some negative, as shown in Figure (4), so S
accounts for particles owing both into and out of the volume V . With outward-pointing surface normals positive leakage indicates a net ow out of V , which decreases N.
The last component to analyze is the change due to collisions, which we separate into absorption and scattering. As discussed in section 2, we assume that particles interact solely with the medium and not each other, making the collision rate independent of . Analysis of the mechanisms of collisions belong to the realm of physical optics, quantum mechanics, etc. At the scale of particle transport, we simply incorporate models for the microscopic processes and look to other elds to supply the various constants for speci c materials.
We assume that the probability of a particle disappearing due to absorption is proportional to the distance of travel through the medium. See Figure (5a). The constant of

Transfer Equations in Global Illumination

1-9

 d '

ds
(a)

d' ' '

d' d'

 d

ds
(b)

 d

(c)

Figure 5: An intuitive view of volume interactions (a) per unit length, 0 / ds, (b) per unit solid angle per unit length, 0 / d!0 ds, and (c) per unit solid angle, 0 / d!0.

proportionality is called the absorption coe cient a, which has units of m;1. The absorption coe cient may vary with position, but is normally assumed to be independent of direction. This is equivalent to assuming that the medium is isotropic, ruling out regular
structure such as that of a crystal. The change in N due to absorption is expressed as

ZZ
Cabs a(r) (r !) dr d!: V

(10)

Collisions due to scattering are more complex. As with absorption, the probability of such a collision occurring is proportional to the distance the particle travels. Upon collision, however, the new direction must also be accounted for. Because of the one-speed assumption, we need not consider other changes to the particle as a result of scattering. We characterize
the process of scattering by the volume scattering kernel k. The function k is de ned on R3 ;1 1] such that

k(r ! !0) dr d!0

is the probability that a particle at r moving in the direction ! will be de ected into the
new direction !0, per unit solid angle about !0 per unit distance of travel. See Figure (5b). The units of k are m;1sr;1. That k depends only on the dot product ! !0 and not the

individual directions is again a statement about the isotropy of the medium.
Scattering may remove particles from V by a process known as out-scatter. In out-scatter, a particle remains within V while its direction is instantaneously changed to

something outside of as a result of a collision. To account for out-scatter we de ne the
term Cout by

ZZ Z

Cout

k(r ! !0) (r !) d!0 dr d!
V S2

(11)

which is the total number of scattering collisions su ered by particles in V per unit time. The opposite of out-scatter is a process by which particles are added to V by

Transfer Equations in Global Illumination

1-10

Cin
scattering into 

Cout
scattering out of 

Cabs
absorption

E
emission from sources

S
streaming through surface

Figure 6: The ve processes a ecting the number of particles in volume V with directions
in solid angle .

being de ected into it. To account for in-scatter we de ne the term Cin by

ZZ Z

Cin

k(r !0 !) (r !0) d!0 dr d!
V S2

(12)

which is the number of particles in V , per unit time, with directions of travel in after
scattering. Note that both Cout and Cin account for particles whose directions lie within
both before and after scattering, which is neither a gain nor a loss. However, we need only
consider the net change due to scattering, which is the di erence between Cin and C ,out
and this cancels the unwanted e ect. Including the de ections from back into in both

terms simpli es the de nitions, allowing the integration to be over S2 instead of S2 ; .

We can now collect the terms corresponding to the ve distinct physical processes that

can change N. Separating the terms into gains and losses and equating them, we have

S C C+ +abs out = E + Cin

| {z } | {z }

losses

gains

(13)

The meanings of the ve terms are summarized in Figure (6).

As it stands, equation (13) applies only to the phase space volume V , yet it contains

within it an equation that applies globally. To extract the global balance equation we need

only eliminate references to the xed sets V and . To do this, observe that all but one

of the terms in equation (13) entail integration over V only the S term is expressed as an

integral over @V . Gauss's theorem can be used to convert the single surface integral into a

volume integral, yielding

ZZ

S = ! r (r !) dr d!:

(14)

V

Transfer Equations in Global Illumination

1-11

Here, in addition to Gauss's theorem, we have used the fact that

r ! (r !)] = ! r (r !)

which holds because ! is xed with respect to the divergence operator. With the new
expression for S, all ve terms in equation (13) entail integration over both V and .
Because V is arbitrary, it follows that equality must hold for the integrands (to within
a set of measure zero). Removing the two outer integrals from all ve terms, we have

Z

!

r

(r !) +

a(r)

(r !) +
Z

k(r !
S2

!0)

(r !) d!0

= q(r !) + k(r !0 !) (r !0) d!0:

S2

(15)

Now, the integral corresponding to Cout on the left-hand side of equation (15) can be

simpli ed because the function does not depend on the variable of integration. We

introduce the scattering coe cient s de ned by

Z
s(r) S2 k(r !0 !0) d!0

1 m

,

which is the probability that a particle will su er a scattering collision per unit distance
traveled, in exact analogy with a(r). Here !0 can be an arbitrary direction in S2 because
of isotropy. Then s becomes a factor of in the balance equation. The two such factors, s and a, can be conveniently grouped into a total interaction coe cient ,

(r) s(r) + a(r)

1 m

,

which is the probability that a particle will su er either kind of collision, per unit distance traveled. With the new notation, equation (15) becomes

Z
! r (r !) + (r) (r !) = q(r !) + k(r !0 !) (r !0) d!0
S2

(16)

which is the standard form of the stationary one-speed particle transport equation in integrodi erential form. When time-dependent phenomena are included, as in many nuclear and astrophysical applications, equation (16) appears in a slightly more general form phase
space ux becomes a function of time, = (r ! t), and an additional term,

1 @ (r ! t)
v @t

(17)

appears on the left-hand side, since equation (6) no longer holds. The above derivation of the transport equation is one of many possible approaches.
In the context of radiative transfer, Chandrasekhar 7] begins by considering directional derivatives of the ux, and Pomraning 40] describes a \Lagrangian" approach based on following packets of photons. Davison 8] and Weinberg and Wigner 59] elaborate many of these same ideas in the context of neutron transport theory. Case and Zweifel 6] and Kourgano 23] give derivations that apply to many di erent physical phenomena. Finally, Preisendorfer 41, 42] has given a rigorous axiomatic derivation of the general transport equation based on measure theory.

Transfer Equations in Global Illumination

1-12

Hs+ Hs-- s

n(s) M

H+ H --

(a) (b)

Figure 7: The surface M partitions (a) the set of directions S2 at each point s 2 M, and (b) the set of all rays originating on M.

2.2 Boundary Conditions
The presence of the gradient operator makes equation (16) a rst-order di erential equation in the spatial variables. As such, it cannot be a complete description of the physical situation in itself. A property of all di erential equations is that they require boundary conditions to eliminate the arbitrary constants of integration 11].
Equation (16) is only valid away from surfaces, which are the boundaries. At the
surfaces, collectively denoted M, we need to specify what happens. To express the boundary conditions, rst observe that M imposes a natural partitioning of S2 into two hemispheres
at each point. Let n(s) denote the surface normal at s 2 M. Then we designate the hemisphere where n(s) ! > 0 the positive hemisphere and de ne the set

Hs+ f! 2 S2 : ! n(s) 0g: Similarly, we de ne the collection of all pairs (s !) corresponding to rays that originate on
M and point outward:

H+ f(s !) 2 M S2 : ! 2 Hs+g: The sets Hs; and H; are de ned analogously, and satisfy
Hs+ Hs; = S2 H+ H; = M S2:

See Figure (7). The purpose of boundary conditions is to specify the behavior of the
particles on the set H+ the set H; is accounted for by particles impinging on M. There are
numerous ways in which these conditions can be speci ed, and di erent physical situations call for di erent boundary conditions 9, 25]. The simplest in form are the explicit boundary conditions in which

(s !) = qb(s !)

(18)

for all (s !) 2 H+. Explicit boundary conditions are independent of itself, accounting for
particles that are generated by independent processes and subsequently enter the system

Transfer Equations in Global Illumination

1-13


n(s)
d i r

'

 n(s)
d i

ss
(a) (b)

Figure 8: Two types of implicit boundary conditions: (a) specular re ection, and (b) directional di use re ection.

through the boundaries. In contrast, implicit or re ecting boundary conditions are of the form

(s !) = f( s !)

(19)

for all (s !) 2 H+. There are two common forms of implicit boundary conditions, both expressing restricted to H+ in terms restricted to H;. The physical interpretation is
that of scattering at the boundary particles originating at the boundary are a direct result of those impinging on it. The rst form is specular re ection, and is of the form

(s !) = F(s ;!0) (s ;!0)

(20)

where !0 is the re ection of ! through the surface normal at s. See Figure (8a). A second,

and far more general type of implicit boundary condition is given by an integral transfor-

mation:

Z
(s !) = Hr; kb(s !0!!) (s !0) d!0

(21)

where kb is
is used here

the in

surface scattering kernel with units of
lieu of \!0 !" to indicate incident and

sr;1. The arrow notation re ected directions. Note

\!0 ! !"
that the

surface scattering kernel lacks the length dimension of volume scattering. This is because

each particle scattering event takes place at the de nite location on the surface determined

by the direction of travel. The integral transformation of equation (21) expresses the density

of particles re ected in any direction as a weighted \sum" of the incoming densities, and

the weighting can depend strongly on both the incoming and outgoing directions. See

Figure (8b). This phenomenon is also known as directional di use re ection 16]. Note that
if we allow the kernel kb to include generalized functions, such as the Dirac delta function,
then we can write

kb(s !0!!) = F(s !0) (!0 ; !)

which subsumes the case of specular re ection. Finally, we note that there are physical
constraints on both F and kb. If the only source of new particles is q, conservation dictates
the constraints

F(s !) 1

(22)

Transfer Equations in Global Illumination

1-14

and
Z
Hs; kb(s !0 ! !) d!(!0) 1
for all (s !) 2 H+. Similarly, both F and kb must be non-negative everywhere.

(23)

3 The Equation of Transfer

The general transport equation derived in the last section is not tied to a particular physical situation. We now rephrase it slightly to apply to the transfer of radiant energy that is, we now account for the semantics of photons. There are three properties of photons that need to be incorporated into the equation. First, photons travel at a constant speed in a
vacuum, this speed is a univeral constant denoted by c. Second, photons have an associated
frequency, an important internal attribute that determines their energy and a ects their behavior. And nally, trajectories of photons are strongly in uenced by surfaces a property shared by gas molecules, but not neutrons.
We begin by translating the abstract notion of phase space ux into the corresponding radiometric concept of radiance. Radiance is the power per unit area per unit solid angle due to radiant energy crossing a surface perpendicularly (or, equivalently, per unit projected area). This is essentially the same concept as phase space ux all that is missing is the notion of energy per photon. But the energy of a photon is related to its frequency by

E = h J],

(24)

where h is Planck's constant. It follows that the relationship between phase space ux and
radiance L(r !) is

L(r !) = h (r !) = ch n(r !)

W m2 sr

.

Similarly, we need to translate the phase space source function into a quantity related to
radiant power. We de ne a volume source term " by

"(r !) h q(r !)

W m3 sr

.

The physical process of emission is a phenomenon of matter, and therefore applies only to volumes. Nonetheless, it is a useful abstraction to allow surfaces to be emitters 39]. We
de ne a surface source term "b by

"b(s !) h qb(s !)

W m2 sr

.

The functions L, ", and "b will play the same roles as their abstract counterparts, with the
di erence that they are now linked to physical units meaningful to the transfer of radiant energy.

Transfer Equations in Global Illumination

1-15

n(s)
 ' i r

 i
x

r y

Figure 9: The local coordinates for bidirectional re ectance.

Because surfaces are a dominant in uence in the realm of photons, we impose boundary conditions that are most general, including both explicit and implicit terms. Then the
transport equation can be written in terms of L:

Z
! rL(r !) + (r)L(r !) = "(r !) + k(r !0 !) L(r !0) d!0
S2
Z
L(s !) = "b(s !) + Hs;kb(s !0 ! !) L(s !0) d!0

(25)

where s is a boundary point. Equation (25) is the stationary gray equation of transfer with
boundary conditions. Both emission and collision behaviors of neutral particles may depend upon internal
states or speed. Therefore " "b k, and kb are generally all functions of these attributes.
In photon transport these functions are usually strongly frequency-dependent. The onespeed assumption, which translates into xed frequency for photons, allows simulations at di erent frequencies to be decoupled. It is common in global illumination to use three or more concurrent but independent simulations corresponding to di erent frequencies.
The surface scattering kernel may be expressed in radiometric terms by relating it to the bidirectional re ectance distribution function, or BRDF, . Denoting the BRDF at the
point s 2 M by s, we have

kb(s !0 !!) = s( i i r r) cos i

1 sr

,

(26)

where the incoming and outgoing directions have been expressed as incident and re ected

angles cosine

to indicate a shift to local coordinates. of the angle of incidence. See Figure (9).

For The

instance, units of

cos i
s are

= ;n(s)
also sr;1,

!0 is
as cos

the i is

dimensionless. The volume scattering kernel can also be put into another form by factoring

out the phase function Pr(x) de ned by

Pr(x)

4

k(r x) s(r)

1 sr

,

(27)

Transfer Equations in Global Illumination

1-16

where x 2 ;1 1] encodes the cosine of the angle between the directions before and after scattering. In terms of Pr, the volume scattering kernel is

k(r !0

!) =

s(r)

Pr(!0
4

!)

(28)

which has the advantage of separating the notions of collision probability per unit length and the resulting distribution of directions. See Figure (5c). The 4 appears in the de nition of
phase function so that P 1 corresponds to uniform scattering in all directions. A common
empirical phase function due to Rayleigh is

P

(x)

=

3 4

(1

+

x2):

(29)

3.1 Integral Form

In this section we derive an alternate form of the equation of transfer that is a pure integral equation instead of an integro-di erential equation, as equation (25). In performing this transformation the boundary conditions are absorbed into the equation, leaving a single expression that is equivalent but sometimes more convenient. The derivation below parallels those of Pomraning 40] and Williams 63]. The idea is to integrate equation (25) along a ray until a boundary point is reached. The integration eliminates the di erential operator and also incorporates the boundary value at the point of intersection with the ray. The key
observation is that the operator ! r is a directional derivative in the direction !, allowing
us to write

! rL(r !) =

@ @x

L(r

+

x!

!)

x=0

=

;

@ @x

L(r ;

x!

!)

x=0

where x 2 R parametrizes the ray through r parallel to !. We shall express L(r !) in terms of what happens along the ray (r ;!), which makes the second expression above a more convenient choice. To simplify notation, we de ne Q(r !) to be the gains due to volume
emission and in-scattering,

Z
Q(r !) "(r !) + k(r !0 !)L(r !0) d!0
S2

(30)

and introduce the single-parameter functions

Lb(x) L(r ; x! !) Qb(x) Q(r ; x! !) b(x) (r ; x!)

where r and ! are to be considered xed. Ignoring the boundary conditions for the moment,
equation (25) can be written as

d dx

Lb(x)

;

b(x)

Lb(x)

=

;Qb(x):

(31)

Transfer Equations in Global Illumination

1-17

s
n(s)
h

boundary
r 

Figure 10: The boundary point s corresponding to the ray (r !). The point s is given by (r ;!), and the distance h by b(r ;!).

Note that the term Qb(x) has no explicit dependence on Lb. Even though Lb is subsumed
by the in-scattering term of equation (30), its contribution is only on a set of measure
zero. Therefore, equation (31) is a linear rst-order ordinary di erential equation in Lb
with variable coe cients, which is easily solved by means of an integrating factor 45]. By de ning

v(x)

exp

Z
;

x b(y) dy

0

(32)

equation (31) can be written as

d dx

hv(x)

Lb(x)i

=

;v(x)

Qb(x)

(33)

which is in a form that can be integrated directly. By integrating both sides from 0 to x and noting that v(0) = 1, we solve for Lb(0), yielding

Lb(0) = v(x)Lb(x) + Z xv(y) Qb(y) dy: 0

(34)

Here we have chosen to solve for Lb(0) because Lb(0) = L(r !). Although equation (34)
holds for any x, it is only useful if we have a convenient expression for Lb(x) otherwise we have made no progress toward a simpler representaion for Lb(0). Fortunately, if we choose x so that Lb(x) lies on the boundary, the boundary conditions provide such an expression.
That is, we let x = b(r ;!) where

b(r !) inffx > 0 : r + x! 2 Mg

gives the distance to the nearest point of intersection with the boundary along the given ray. Similarly, we de ne the closely related function by

(r !) r + b(r !)!

which returns the actual point of intersection. See Figure (10). For simplicity, we assume
that the surfaces M form a complete enclosure so that b and are always well-de ned this

Transfer Equations in Global Illumination

1-18

is always possible by surrounding the scene with a non-re ecting surface if necessary. Now,

to incorporate the value at the boundary into equation (34), we de ne ; to be the boundary

function

Z
;(s !) "b(s !) + Hs;kb(s !0!!) L(s !0) d!0

(35)

for any (s !) 2 H+. We must also generalize equation (34) back to a form that holds for

any ray, so we introduce several new functions. The optical distance function is de ned by

(r r0) Z jjr0;rjj (r + yu) dy

(36)

0

where u = (r0 ;r)= jjr0 ; rjj is the unit vector pointing from r to r0, and the path absorption

function is de ned by

(r r0) e; (r r0):

(37)

The function is simply a more general form of the integrating factor v(x). Note that both
and are dimensionless. Finally, the stationary gray equation of transfer in integral form can be written as

L(r !) = (s r) ;(s !) + Z h (r ; x! r) Q(r ; x! !) dx 0

(38)

where s = (r ;!) and h = b(r ;!). Note that both ; and Q are functions of L, so equa-
tion (38) is not a closed-form expression for L it is merely an alternative to equation (25) in which the boundary conditions are built in. Similar equations can be derived when L is
time-dependent 63] and where there is coupling between frequencies 58] in both cases the derivation proceeds as above after applying a Laplace transform.

3.2 Special Cases of the Equation of Transfer
The equation of transfer has several direct applications in global illuminaition, including the simulating of participating media 21, 46] and physically similar e ects 24] as well as subsurface scattering 15]. But its usefulness extends beyond these applications. Because of the generality of the equation of transfer, it subsumes many of the equations used in global illumination and volume rendering. Just as the rendering equation 19] uni es an array of rendering techniques, the equation of transfer encompasses an even larger class. We now consider some of the special cases that it subsumes.

3.2.1 Vacuum Conditions
If the space separating the surfaces is a vacuum, there can be no volume emission and no particle collisions except at surfaces. Under these conditions equation (25) all but disappears, leaving behind little more than the boundary conditions. More precisely, vacuum conditions imply that
"0
a0 s0

Transfer Equations in Global Illumination

1-19

n(s) s

s' 
n(s')

Figure 11: With vacuum conditions, the incident radiance at (s !) is equal to the radiance at (s0 !).

therefore, equation (25) reduces to

! rL(r !) = 0

(39)

for all r 2 R3 ; M and ! 2 S2. Equation (39) states that the directional derivative of L vanishes everywhere in a vacuum. This implies that the radiance function L(r !) is invariant along each direction !, and consequently, L(r !) at any interior point is determined by a
point on the boundary:

L(r !) = L( (r ;!) !)

(40)

for all (r !) 2 R3 S2. See Figure (11). Substituting equation (40) into the boundary

condition of equation (25), we have

Z
L(s !) = "b(s !) + Hs;kb(s !0!!) L( (s ;!0) !0) d!0

(41)

which is a balance equation for L(s !) restricted to H+. This is the governing equation for

direct radiative transfer between surfaces it describes the same physical situation as the

rendering equation 19], but in terms of radiance.

The equation simpli es further if we assume that all surfaces are pure di use re ectors.

In this case the radiance function depends on position but not direction. Making the

corresponding changes to L and , we arrive at the continuous version of the radiosity

equation:

Z
L(s) = "b(s) + (s) Hs;L( (s ;!0)) cos i d!0:

(42)

3.2.2 Non-Scattering Media

Now consider the case where there is a medium that absorbs and emits, but does not scatter. That is,

s 0:

Transfer Equations in Global Illumination

1-20

In this case it will be easier to study the implication by starting with the integral form of
the equation of transfer. The absence of scattering implies that the function Q de ned in
equation (30) reduces to

Q(r !) "(r !)

(43)

so the governing equation is

L(r !) = (s r) ;(s !) + Z h (r ; x! r) "(r ; x! !) dx 0

(44)

where s = (r ;!) and h = b(r ;!). If we further assume that the boundaries are non-
re ecting, then

;(s !) "b(s !)

(45)

for all (s !) 2 H+. Under these assumptions equation (44) no longer depends upon L at

all. the

The value of L(r
volume emittance

!) is therefore a function
function "(r !) along the

only of path of

the the

absorption coe cient
ray (r ;!). Using the

a(r) and
notation

introduced in section 3.1, the equation for L(r !) can then be written as

Lb(0) = v(x)"bb(x) + Z xv(y)"b(y) dy

=

exp

Z
;

0
x b(z) dz

"bb(x)

+

Z

x
exp

; Z y b(z) dz

"b(y) dy

0 00

(46)

where x is the distance to the rst surface, and

"bb(x) "b(r ; x! !) "b(x) "(r ; x! !):

Finally, if we neglect the surfaces altogether, we have the emission-absorption model frequently used in volume rendering 21]:

Lb(0) = Z 1exp ; Z y b(z) dz "b(y) dy: 00

(47)

Transfer Equations in Global Illumination

1-21

Nomenclature

Symbol

b(r !)

HHs++

k(r ! !0)

kLb((rs

!! !)

!0)

M

n(r !)

n(s)

qP(rr(x!))

qrb(s !)

Rn

s

S2

V

(r r0)

sa((r(rr)))

"(r !)

"b((rs

!) !)

(r !)

s(r( ri 0) i r r)

!

Units m { { m;1 sr;1 sr;1 W m;2 sr;1 { m;3 sr;1 { sr;1 m;3 sr;1 s;1 m;2 sr;1 s;1 { { { { { { m;1 m;1 m;1 W m;3 sr;1 W m;2 sr;1 m;2 sr;1 s;1 { sr;1 { { {

Page 1-17 1-12 1-12 1-9 1-13 1-14 1-12 1-5 1-12 1-15 1-8 1-12 1-5 1-4 1-12 1-4 1-7 1-18 1-9 1-11 1-11 1-14 1-14 1-5 1-17 1-15 1-18 1-5 1-7

Meaning distance along the ray to boundary
positive hemisphere at a point s 2 M
outgoing rays originating on M
volume scattering kernel surface scattering kernel radiance function all surfaces (boundaries) phase space density surface normal function
normalized phase function at r
phase space source function explicit boundary condition
a point in R3 representing a position
n-dimensional Euclidean space
a point in R3 representing a boundary point the unit sphere in R3 a volume in R3
path absorption absorption coe cient scattering coe cient total interaction coe cient volume emittance function surface emittance function phase space ux ray shooting function bidirectional re ectance distribution function optical distance
a vector in S2 representing a direction a subset of S2 representing a solid angle

References

1] James Arvo and David Kirk. Particle transport and image synthesis. Computer Graphics, 24(4):63{66, August 1990.
2] R. Byron Bird, Warren E. Stewart, and Edwin N. Lightfoot. Transport Phenomena. John Wiley & Sons, New York, 1960.
3] Christoph C. Borel, Siegfried A. W. Gerstl, and Bill J. Powers. The radiosity method in optical remote sensing of structured 3-d surfaces. Remote Sensing of the Environment, 36:13{44, 1991.
4] Chris Buckalew and Donald Fussell. Illumination networks: Fast realistic rendering with general re ectance functions. Computer Graphics, 23(3):89{98, July 1989.
5] Kenneth M. Case, F. de Ho mann, and G. Placzek. Introduction to the Theory of Neutron Di usion, volume 1. Los Alamos Scienti c Laboratory, Los Alamos, New Mexico, 1953.
6] Kenneth M. Case and Paul F. Zweifel. Linear Transport Theory. Addison-Wesley, New York, 1967.

Transfer Equations in Global Illumination

1-22

7] S. Chandrasekar. Radiative Transfer. Dover Publications, New York, 1960. 8] B. Davison. Neutron Transport Theory. Oxford University Press, New York, 1957. 9] James J. Duderstadt and William R. Martin. Transport Theory. John Wiley & Sons, New
York, 1979. 10] Richard P. Feynmann. QED, The Strange Theory of Light and Matter. Princeton University
Press, Princeton, New Jersey, 1985. 11] Samuel Glasstone and Alexander Sesonske. Nuclear Reactor Engineering. Van Nostrand, Prince-
ton, New Jersey, 1967. 12] Narendra S. Goel, Ivan Rozehnal, and Richard L. Thompson. A computer graphics based
model for scattering from objects of arbitrary shapes in the optical region. Remote Sensing of the Environment, 36:73{104, 1991. 13] Cindy M. Goral, Kenneth E. Torrance, Donald P. Greenberg, and Bennett Battaile. Modeling the interaction of light between di use surfaces. Computer Graphics, 18(3):213{222, July 1984. 14] Harold Grad. Principles of the kinetic theory of gases. In S. Flugge, editor, Handbuch der Physik, volume 12, pages 205{294. Springer-Verlag, New York, 1958. 15] Xiao D. He. Physically-Based Models for the Re ection, Transmission and Subsurface Scattering of Light by Smooth and Rough Surfaces, with Applications to Realistic Image Synthesis. PhD thesis, Cornell University, January 1993. 16] Xiao D. He, Kenneth E. Torrance, Francois X. Sillion, and Donald P. Greenberg. A comprehensive physical model for light re ection. Computer Graphics, 25(4):175{186, July 1991. 17] W. L. Hendry, K. D. Lathrop, S. Vandervoort, and J. Wooten. Bibliography on neutral particle transport theory. Technical Report LA-4287-MS, United States Atomic Energy Commission, 1970. 18] J. C. Hunsaker. Dimensional analysis and similitude in mechanics. In Theodore von Karman Anniversary Volume Contributions to Applied Mechanics and Related Subjects, pages 21{48. California Institute of Technology, Pasadena, California, 1941. 19] James T. Kajiya. The rendering equation. Computer Graphics, 20(4):143{150, August 1986. 20] James T. Kajiya. Radiometry and photometry for computer graphics. In Advanced Topics in Ray Tracing, SIGGRAPH 90 Course Notes, volume 24, August 1990. 21] James T. Kajiya and Brian P. Von Herzen. Ray tracing volume densities. Computer Graphics, 18(3):165{173, July 1984. 22] Morris Kline and Irvin W. Kay. Electromagnetic Theory and Geometrical Optics. John Wiley & Sons, New York, 1965. 23] V. Kourgano . Basic Methods in Transfer Problems: Radiative Equilibrium and Neutron Diffusion. Oxford University Press, New York, 1952. 24] Wolfgang Krueger. Volume rendering and data feature enhancement. Computer Graphics, 24(5):21{26, November 1990. 25] Jacqueline Lenoble, editor. Radiative Transfer in Scattering and Absorbing Atmospheres: Standard Computational Procedures. Studies in Geophysical Optics and Remote Sensing. A. Deepak, Hampton, Virginia, 1985. 26] Je ery Lewins. Importance, The Adjoint Function: The Physical Basis of Variational and Perturbation Theory in Transport and Di usion Problems. Pergamon Press, New York, 1965. 27] E. E. Lewis and W. F. Miller, Jr. Computational Methods of Neutron Transport. John Wiley & Sons, New York, 1984.

Transfer Equations in Global Illumination

1-23

28] Rudolf K. Luneburg. Mathematical Theory of Optics. University of California, Berkeley, California, 1964.
29] Donald H. Menzel, editor. Selected Papers on the Transfer of Radiation. Dover Publications, New York, 1966.
30] Jurgen R. Meyer-Arendt. Radiometry and photometry: Units and conversion factors. Applied Optics, 7(10):2081{2084, October 1968.
31] Parry Moon. The Scienti c Basis of Illuminating Engineering. McGraw-Hill, New York, 1936. 32] Parry Moon and Domina E. Spencer. Lighting Design. Addison-Wesley, Cambridge, Mas-
sachusetts, 1948. 33] Ranga B. Myneni and Juhan Ross, editors. Photon-Vegetation Interactions. Springer-Verlag,
New York, 1991. 34] Ranga B. Myneni, Juhan Ross, and Ghassem Asrar. A review on the theory of photon transport
in leaf canopies. Agricultural and Forest Meterology, 45(1{2):1{153, February 1989. 35] National Bureau of Standards. The International System of Units (SI). U.S. Government
Printing O ce, Washington DC, 1977. Special Publication 330. 36] Fred E. Nicodemus. Radiance. American Journal of Physics, 31:368{377, 1963. 37] Fred E. Nicodemus, J. C. Richmond, J. J. Hisa, I. W. Ginsberg, and T. Limperis. Geometrical
Considerations and Nomenclature for Re ectance. Monograph number 160. National Bureau of Standards, Washington DC, 1977. 38] Tomoyuki Nishita and Eihachiro Nakamae. Continuous tone representation of 3-D objects taking account of shadows and interre ection. Computer Graphics, 19(3):23{30, July 1985. 39] Max Planck. The Theory of Heat Radiation. Dover Publications, New York, 1988. 40] G. C. Pomraning. The Equations of Radiation Hydrodynamics. Pergamon Press, New York, 1973. 41] Rudolph W. Preisendorfer. A mathematical foundation for radiative transfer theory. Journal of Mathematics and Mechanics, 6(6):685{730, November 1957. 42] Rudolph W. Preisendorfer. Radiative transfer axioms. Technical Report 57-44, Scripps Institution of Oceanography Visibility Laboratory, University of California, San Diego, October 1957. 43] Rudolph W. Preisendorfer. Radiative Transfer on Discrete Spaces. Pergamon Press, New York, 1965. 44] Rudolph W. Preisendorfer. Hydrologic Optics, Volumes I{VI. National Oceanic & Atmospheric Administration, Honolulu, Hawaii, 1976. (Available as NTIS PB-259 793). 45] Earl D. Rainville and Phillip E. Bedient. Elementary Di erential Equations. The Macmillan Company, New York, fth edition, 1974. 46] Holly E. Rushmeier and Kenneth E. Torrance. The zonal method for calculating light intensities in the presence of a participating medium. Computer Graphics, 21(4):293{302, July 1987. 47] Holly E. Rushmeier and Kenneth E. Torrance. Extending the radiosity method to include specularly re ecting and translucent materials. ACM Transactions on Graphics, 9(1):1{27, January 1990. 48] Arthur Schuster. Radiation through a foggy atmosphere. Astrophysical Journal, 21(1):1{22, January 1905.

Transfer Equations in Global Illumination

1-24

49] K. Schwarzschild. On the equilibrium of the sun's atmosphere. Nachrichten von der Koniglichen Gesellschaft der Wissenschaften zu Gottingen. Math.-phys. Klasse, 195:41{53, 1906. (See 29] for English translation).
50] Peter Shirley. A ray tracing algorithm for global illumination. Graphics Interface `90, pages 205{212, May 1990.
51] Robert Siegel and John R. Howell. Thermal Radiation Heat Transfer. Hemisphere Publishing Corp., New York, second edition, 1981.
52] Francois Sillion, James Arvo, Stephen Westin, and Donald P. Greenberg. A global illumination solution for general re ectance distributions. Computer Graphics, 25(4):187{196, July 1991.
53] Francois Sillion and Claude Puech. A general two-pass method integrating specular and di use re ection. Computer Graphics, 23(4), August 1989.
54] Brian Smits, James Arvo, and David Salesin. An importance-driven radiosity algorithm. Computer Graphics, 26(4):273{282, July 1992.
55] Jerome Spanier and Ely M. Gelbard. Monte Carlo Principles and Neutron Transport Problems. Addison-Wesley, Reading, Massachusetts, 1969.
56] I. F. Spiro, R. C. Jones, and D. Q. Wark. Atmospheric transmission: Concepts, symbols, units and nomenclature. Infrared Physics, 5(1):11{36, 1965.
57] Gregory J. Ward. Measuring and modeling anisotropic re ection. Computer Graphics, 26(2):265{272, July 1992.
58] Alvin M. Weinberg. Theory of Neutron Chain Reactions. Technical Information Service, Oak Ridge, Tennessee, 1951.
59] Alvin M. Weinberg and Eugene P. Wigner. The Physical Theory of Neutron Chain Reactors. University of Chicago Press, 1958.
60] Stephen Westin, James Arvo, and Kenneth Torrance. Predicting re ectance functions from complex surfaces. Computer Graphics, 26(2):255{264, July 1992.
61] Turner Whitted. An improved illumination model for shaded display. Communications of the ACM, 32(6):343{349, June 1980.
62] Eugene P. Wigner. Mathematical problems of nuclear reactor theory. In Nuclear Reactor Theory. Proceedings of the Eleventh Symposium in Applied Mathematics, pages 89{104. American Mathematical Society, Providence, Rhode Island, 1961.
63] M. M. R. Williams. Mathematical Methods in Particle Transport Theory. John Wiley & Sons, New York, 1971.
64] Lawrence B. Wolf. Di use re ection. Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, 23(4):472{478, June 1992.

Transfer Equations in Global Illumination

1-25

Global Illumination:
Transfer Equations, Linear Operators and Integral Equations
Jim Arvo Program of Computer Graphics
Cornell University

The Equations of Global Illumination
Origins Assumptions Connections

What we'll cover
Equations of Radiative Transfer
Derivation of classical transfer equation Physical assumptions Connections with other fields Simplified models
Mathematical Tools & Concepts
Linear Operators Integral Equations Using "Importance"
Radiative Transfer
Interaction of light with matter at the macroscopic scale Based on energy conservation Expresed by equation of transfer Originated in astrophysics
Schuster 1905 Schwarzschild 1906 Chandrasekhar 1947
Work Involving Volume Interactions
Blinn 1982 dusty surfaces
Kajiya and Von Herzen 1984 clouds
Rushmeier and Torrance 1987, 1990 radiosity + participating media
Krueger 1990 volume rendering
He 1993 subsurface scattering

Physical Models and Physically-Based Rendering
Wave Model of Light
Physical Optics Maxwell's Equations Diffraction & Interference
Particle Model of Light
Geometrical Optics Phenomenological Description Intensity and Color
Surface Scattering Volume Scattering

Interface between materials

Participating medium

Why study the equation of transfer?
Describes important phenomena Participating media Subsurface scattering
Provides a link to relevant literature Radiative transfer Other fields
A useful conceptual model Subsumes global illumination Clarifies assumptions & generalizations

Transfer Equations in Global Illumination

1-26

The Grand Scheme
Radiosity Equation

Abstract Particles Physical Assumptions

Balance Equation

Properties of Photons

Equation of Transfer

No Medium

No Scattering

Rendering Equation

Volume Rend Equation

Assumptions about Particles
Collisions are instantaneous Mono-energetic (gray, or one-speed) No interactions among particles Infinitely small & numerous No external influences

Deriving a Balance Equation

Particles are in constant motion, so equilibrium is dynamic. Changes due to all three behaviors must balance.

[ ] [ ] [ ]change

change

change

+ + = 0due to

due to

due to

Emission

Streaming

Collisions

A Portion of Phase Space Expressed as a Cartesian Product

V ×

3D Volume in R3

Solid Angle in S2

{
{
{

Related Phenomena
These very distinct physical phenomena have nearly identical governing equations:
Radiative Transfer Photons Neutron Transport Neutrons Gas Dynamics Molecules
Particle Behaviors
scattering absorption
Emission Streaming Collisions
Phase Space
Used to represent state of particles Captures all degrees of freedom
3 for position 2 for direction of travel More for internal states (energy)
5-dimensional in one-speed case R3 × S2 is the whole space
The Cartesian Product V× 
A Simple Phase Space Volume

Transfer Equations in Global Illumination

1-27

Phase Space Density n(r,)
(Angular Number Density)
V× 
r  Number of particles in box = n(r,) dr d

Flux from Density
(r,) = v n(r,)

1 m2 sr s

m1 s m3 sr

Phase Space Flux  = v n

dA

n ds dA d = n (v dt) dA d =  dt dA d

d ds



A Balance Equation for Particles
 (r,) + (r) (r,) = q(r, ) + k(r ; . ') (r, ' ) d'
S2
Particle conservation is expressed by an integro-differential equation

{
{
{
{
{

Particle Behaviors
scattering absorption
Emission Streaming Collisions

The Emission Term

q(r,) dr d
V

1 m3 sr s

m3

sr

[

1 s

]

Particles per second

Emission Accounts for Creation of New Particles

[ ]q(r,)

1 m3 sr s

Phase space source function q accounts for new particles generated by chemical, thermal, or nuclear processes.

Absorption Accounts for Particles that are Destroyed

The rate of absorption is proportional to the phase space flux .

Transfer Equations in Global Illumination

1-28

Absorption: Collisions per Unit Distance
 ' d ds d'
The probability of absorption is proportional to the distance of travel.
Out-Scatter Accounts for Particles Deflected Out of 

The Absorption Term

a(r) (r,) dr d
V

1 m

1 m2 sr s

m3 sr

[

1 s

]

Particles per second

In-Scatter Accounts for Particles Deflected Into 

The rate of scattering is proportional to the phase space flux .

Scattering per Unit Distance per Unit Solid Angle
'

d'

 d

ds

The probability of scattering is proportional to the distance of travel and the solid angle.

Leakage Accounts for Particles that Stream Out of V
V

Leakage depends only on the flux  over V

Scattering collisions change the direction of travel instantaneously.

The Scattering Terms
' for in-scatter  for out-scatter
k(r;.') (r, ) d'dr d
 V S2

1 m sr

1 m2 sr s

sr m3 sr

Computing Leakage Through V
n V
 
n

n
(s,)  n(s) ds d  V

Transfer Equations in Global Illumination

1-29

Terms of the Balance Equation

Leakage

Abs. & out-scatter

 (r,) + (r) (r,)

= q(r, ) +
Emission

k(r; .') (r,') d'
S2
In-scatter

The Semantics of Photons
Particles carry energy Phase space flux becomes radiance L(r,) = h (r,)
Complex interactions with boundaries Implicit boundary conditions essential
Strong frequency dependence Emission and collisions depend on 

Boundary Conditions
Needed for complete balance equation The differential operator requires boundary conditions
Two major forms Explicit (Sources) Implicit (Reflecting)
Crucial in image synthesis Surface effects predominate

Radiance
(Intensity)
L(r,) = h (r,)

[ ]J m2 sr s

J

1 m2 sr s

[ ]W m2 sr

Directional Diffuse Reflection '
n(s) i d'
s
dL(s,) = kb(s;' ) L(s,') d'
Local Coordinate System of the BRDF n(s) 
' r i
i r y
x
kb(s;' ) = s(i,i,r,r) cos i

Boundary Conditions for the Equation of Transfer

L(s,) = b(s, ) + kb(s; ' )L(s,') d'
S2

{
{

[ ]surface scattering kernel

1 sr

[ ]surface emittance

W m2 sr

Vacuum Conditions
In a vacuum, the volume scattering and emission terms disappear, leaving only
 L(r,) = 0
which implies that radiance is constant along straight lines.

Transfer Equations in Global Illumination

1-30

Radiance Determined from other Surfaces

n(s) s


Surfaces separated by a vacuum

s' n(s')

The radiance at s in direction  is given by the radiance at s' in direction .

Derivation of Integral Form

s
n(s) h

boundary
r 

Integrate combined source term backwards along the ray until boundary is reached.

An Equation for Direct Exchange Between Surfaces

L(s,) = b(s, ) + kb(s; ' )L(s',') d'
S2

H+ H-

This is an equation for L defined on the set H +. The values of L on H -are
given by other surfaces.

Non-Scattering Medium and Boundary
x L(0) = v(x) b(x) + v(y) (y) dy
0

x - (z) dz
e0
optical distance

L(0)

x

